name: JB Update Latest IDE Images
on:
  workflow_dispatch:
  schedule:
    # At 11:00 on every day.
    - cron: "0 11 * * *"
  push:
    branches:
      - "main"
    paths:
      - "components/ide/jetbrains/backend-plugin/gradle-latest.properties"

jobs:
  intellij:
    uses: ./.github/workflows/jetbrains-auto-update-template.yml
    with:
      productId: intellij
      productCode: IIU
    secrets:
      projectId: ${{ secrets.GCP_PROJECT_ID }}
      serviceAccountKey: ${{ secrets.GCP_SA_KEY }}
      slackWebhook: ${{ secrets.IDE_SLACK_WEBHOOK }}
      runner_token: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_TOKEN }}
      gcp_credentials: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_GCP_CREDENTIALS }}
  goland:
    uses: ./.github/workflows/jetbrains-auto-update-template.yml
    with:
      productId: goland
      productCode: GO
    secrets:
      projectId: ${{ secrets.GCP_PROJECT_ID }}
      serviceAccountKey: ${{ secrets.GCP_SA_KEY }}
      slackWebhook: ${{ secrets.IDE_SLACK_WEBHOOK }}
      runner_token: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_TOKEN }}
      gcp_credentials: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_GCP_CREDENTIALS }}
  pycharm:
    uses: ./.github/workflows/jetbrains-auto-update-template.yml
    with:
      productId: pycharm
      productCode: PCP
    secrets:
      projectId: ${{ secrets.GCP_PROJECT_ID }}
      serviceAccountKey: ${{ secrets.GCP_SA_KEY }}
      slackWebhook: ${{ secrets.IDE_SLACK_WEBHOOK }}
      runner_token: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_TOKEN }}
      gcp_credentials: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_GCP_CREDENTIALS }}
  phpstorm:
    uses: ./.github/workflows/jetbrains-auto-update-template.yml
    with:
      productId: phpstorm
      productCode: PS
    secrets:
      projectId: ${{ secrets.GCP_PROJECT_ID }}
      serviceAccountKey: ${{ secrets.GCP_SA_KEY }}
      slackWebhook: ${{ secrets.IDE_SLACK_WEBHOOK }}
      runner_token: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_TOKEN }}
      gcp_credentials: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_GCP_CREDENTIALS }}
  rubymine:
    uses: ./.github/workflows/jetbrains-auto-update-template.yml
    with:
      productId: rubymine
      productCode: RM
    secrets:
      projectId: ${{ secrets.GCP_PROJECT_ID }}
      serviceAccountKey: ${{ secrets.GCP_SA_KEY }}
      slackWebhook: ${{ secrets.IDE_SLACK_WEBHOOK }}
      runner_token: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_TOKEN }}
      gcp_credentials: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_GCP_CREDENTIALS }}
  webstorm:
    uses: ./.github/workflows/jetbrains-auto-update-template.yml
    with:
      productId: webstorm
      productCode: WS
    secrets:
      projectId: ${{ secrets.GCP_PROJECT_ID }}
      serviceAccountKey: ${{ secrets.GCP_SA_KEY }}
      slackWebhook: ${{ secrets.IDE_SLACK_WEBHOOK }}
      runner_token: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_TOKEN }}
      gcp_credentials: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_GCP_CREDENTIALS }}
  rider:
    uses: ./.github/workflows/jetbrains-auto-update-template.yml
    with:
      productId: rider
      productCode: RD
    secrets:
      projectId: ${{ secrets.GCP_PROJECT_ID }}
      serviceAccountKey: ${{ secrets.GCP_SA_KEY }}
      slackWebhook: ${{ secrets.IDE_SLACK_WEBHOOK }}
      runner_token: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_TOKEN }}
      gcp_credentials: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_GCP_CREDENTIALS }}
  clion:
    uses: ./.github/workflows/jetbrains-auto-update-template.yml
    with:
      productId: clion
      productCode: CL
    secrets:
      projectId: ${{ secrets.GCP_PROJECT_ID }}
      serviceAccountKey: ${{ secrets.GCP_SA_KEY }}
      slackWebhook: ${{ secrets.IDE_SLACK_WEBHOOK }}
      runner_token: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_TOKEN }}
      gcp_credentials: ${{ secrets.SELF_HOSTED_GITHUB_RUNNER_GCP_CREDENTIALS }}
