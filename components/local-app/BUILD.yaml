packages:
  # remaining packages are added by the BUILD.js generator
  - name: docker
    type: docker
    deps:
      - :app
    argdeps:
      - imageRepoBase
    config:
      buildArgs:
        VERSION: ${version}
      dockerfile: leeway.Dockerfile
      image:
        - ${imageRepoBase}/local-app:${version}
        - ${imageRepoBase}/local-app:commit-${__git_commit}

scripts:
  - name: install-cli
    description: "Install gitpod-cli as gitpod command and add auto-completion. Usage: '. $(leeway run components/local-app:install-cli)'"
    script: |
      go build -o gitpod ./main/gitpod-cli
      sudo mv gitpod /usr/bin/gitpod
      # add exec permission
      sudo chmod +x /usr/bin/gitpod

      # pipe completion to bash-completion with sudo
      sudo /usr/bin/gitpod completion bash | sudo tee /usr/share/bash-completion/completions/gitpod
