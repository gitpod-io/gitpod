packages:
  - name: app
    type: go
    srcs:
      - go.mod
      - go.sum
      - "**/*.go"
      - "**/*.c"
    deps:
      - components/common-go:lib
      - components/content-service-api/go:lib
      - components/ws-daemon-api/go:lib
    prep:
      - ["sh", "-c", "pkg-config --atleast-version=2.5.0 libseccomp || (echo \"requires libseccomp > 2.5.0\"; exit 1)"]
    config:
      packaging: app
      buildCommand: ["go", "build", "-ldflags", "-w -extldflags \"-static\" -X 'github.com/gitpod-io/gitpod/workspacekit/cmd.Version=commit-${__git_commit}'"]
  - name: fuse-overlayfs
    type: generic
    config:
      commands:
        - ["sh", "-c", "curl -o fuse-overlayfs -L https://github.com/containers/fuse-overlayfs/releases/download/v1.7.1/fuse-overlayfs-x86_64 && chmod +x fuse-overlayfs"]
  - name: lib
    type: go
    srcs:
      - go.mod
      - go.sum
      - "pkg/**/*.go"
      - "pkg/**/*.c"
    deps:
      - components/common-go:lib
      - components/ws-daemon-api/go:lib
      - components/content-service-api/go:lib
    config:
      packaging: library
      dontTest: true
