## start with
##    loadgen benchmark prod-benchmark.yaml

workspaces: 10
ideImage: eu.gcr.io/gitpod-core-dev/build/ide/code:commit-ff263e14024f00d0ed78386b4417dfa6bcd4ae2f
waitForRunning: "600s"
waitForStopping: "600s"
successRate: 0.80
environment:
  - name: "THEIA_SUPERVISOR_TOKENS"
    value: '[{"token":"foobar","host":"gitpod-staging.com","scope":["function:getWorkspace","function:getLoggedInUser","function:getPortAuthenticationToken","function:getWorkspaceOwner","function:getWorkspaceUsers","function:isWorkspaceOwner","function:controlAdmission","function:setWorkspaceTimeout","function:getWorkspaceTimeout","function:sendHeartBeat","function:getOpenPorts","function:openPort","function:closePort","function:getLayout","function:generateNewGitpodToken","function:takeSnapshot","function:storeLayout","function:stopWorkspace","resource:workspace::fa498dcc-0a84-448f-9666-79f297ad821a::get/update","resource:workspaceInstance::e0a17083-6a78-441a-9b97-ef90d6aff463::get/update/delete","resource:snapshot::*::create/get","resource:gitpodToken::*::create","resource:userStorage::*::create/get/update"],"expiryDate":"2020-12-01T07:55:12.501Z","reuse":2}]'
repos:
  - cloneURL: https://github.com/Furisto/workspace-stress
    cloneTarget: main
    score: 20
    workspaceImage: eu.gcr.io/gitpod-dev/dev/loadtest/workspace-stress:latest
    environment:
    # cpu
    - name: "CPU_COUNT"
      value: "3"
    - name: "CPU_BACKOFF"
      value: "10000000"
    - name: "CPU_TIMEOUT"
      value: "600s"
    # common IO
    - name: "IO_FILE_SIZE"
      value: "2g"
    - name: "IO_TOTAL"
      value: "100g"
    - name: "IO_TIMEOUT"
      value: "600"
    # random read/write IO
    # - name: IO_MODE
    #   value: "randrw"
    # - name: "IO_BLOCKSIZE"
    #   value: "8k"
    # - name: "IO_FSYNC"
    #   value: 1000
    # - name: "IO_DEPTH"
    #   value: 10
    # - name: "IO_JOBS"
    #   value: 20
    # sequential read/write IO
    - name: IO_MODE
      value: "rw"
    - name: "IO_BLOCKSIZE"
      value: "1024k"
    - name: "IO_FSYNC"
      value: 10000
    - name: "IO_DEPTH"
      value: 32
    - name: "IO_JOBS"
      value: 1
    # memory
    - name: "MEMORY_BYTES"
      value: "6G"
    - name: "MEMORY_TIMEOUT"
      value: "600s"
    # tasks
    - name: "GITPOD_TASKS"
      value: "[{\"name\":\"start cpu stress\",\"command\":\"stress-ng --cpu ${CPU_COUNT:-3} --backoff ${CPU_BACKOFF:-10000000} --timeout ${CPU_TIMEOUT:-600s}\"},{\"name\":\"start io stress\",\"command\":\"fio --name io-stress --eta-newline=5s --filename=/workspace/gitpod.temp --rw=${IO_MODE} --size=${IO_FILE_SIZE:-2g} --io_size=${IO_TOTAL:-50g} --blocksize=${IO_BLOCKSIZE} --ioengine=libaio --fsync=${IO_FSYNC} --iodepth=${IO_DEPTH} --direct=1 --numjobs=${IO_JOBS} --runtime=${IO_TIMEOUT:-600}\"},{\"name\":\"start memory stress\",\"command\":\"stress-ng --vm 1 --vm-keep --vm-bytes ${MEMORY_BYTES:-6G} --timeout ${MEMORY_TIMEOUT:-600s}\"}]"
  - cloneURL: https://github.com/gitpod-io/template-typescript-node
    cloneTarget: master
    score: 20
    workspaceImage: eu.gcr.io/gitpod-dev/workspace-images:dd3075638ccf424374cc9c681b3d2338908d07115b28e54856cd45604c33768c
  - cloneURL: https://github.com/gitpod-io/template-typescript-react
    cloneTarget: main
    score: 20
    workspaceImage: eu.gcr.io/gitpod-dev/workspace-images:e764b1a602dc4123d9a027358367b5c4a35b62043e3c630731702144b7d37f77
  - cloneURL: https://github.com/gitpod-io/template-python-django
    cloneTarget: main
    score: 20
    workspaceImage: eu.gcr.io/gitpod-dev/workspace-images:e764b1a602dc4123d9a027358367b5c4a35b62043e3c630731702144b7d37f77
  - cloneURL: https://github.com/gitpod-io/template-python-flask
    score: 20
    cloneTarget: main
    workspaceImage: eu.gcr.io/gitpod-dev/workspace-images:32b2dc5f2707904a9338a97c77a039706df661b5c5e4a5851f1ee74f06a38fd3
